<!DOCTYPE html>
<html lang="ja">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song List DB</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«CSS - ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ– */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            background: #f7fafc;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }
        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #3182ce;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            margin-top: 16px;
            color: #718096;
            font-size: 14px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p class="loading-text">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
    </div>
    <div class="container">
        <h1>
            æœ”æ –ã¾ã‚ˆğŸ¼ğŸ·æ›²æ¤œç´¢
            <div class="icon-links">
                <a id="headerYtLink" href="https://www.youtube.com/@asaxmayo" target="_blank" class="yt-link-container">
                    <svg class="yt-icon" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.377.505 9.377.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                    <span id="liveBadge" class="live-badge">LIVE</span>
                </a>
                <a href="https://docs.google.com/spreadsheets/d/1lPv2iDZbVeVTyvMNHXIZMUfDFd7rDrebFVKBckSMoF4/edit?pli=1&gid=1677386991#gid=1677386991" target="_blank" class="icon-link">
                    <svg class="sheets-icon" viewBox="0 0 24 24"><path d="M14.5 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V7.5L14.5 2zM19 20H5V4h8v5h5v11zM7 11h10v2H7v-2zm0 4h10v2H7v-2z"/></svg>
                </a>
            </div>
        </h1>
        
        <div class="tabs">
            <button class="tab-btn active" id="tab-btn-search" onclick="switchTab('search')">æ¤œç´¢</button>
            <button class="tab-btn" id="tab-btn-list" onclick="switchTab('list')">ä¸€è¦§</button>
        </div>
        <div id="search-tab" class="tab-content active">
            <div class="search-box">
                <label for="searchQuery">æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
                <div class="search-input-wrapper">
                    <input type="text" id="searchQuery" placeholder="æ›²åã€ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã§æ¤œç´¢...">
                    <span id="clearSearch" class="clear-btn">Ã—</span>
                    <span id="resultCountInline" class="result-count-inline"></span>
                </div>
                <div class="search-type" id="searchTypeGroup">
                    <label class="radio-label"><input type="radio" name="stype" value="all" checked>ã™ã¹ã¦</label>
                    <label class="radio-label"><input type="radio" name="stype" value="song">æ›²å</label>
                    <label class="radio-label"><input type="radio" name="stype" value="artist">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ</label>
                    <label class="radio-label"><input type="radio" name="stype" value="tieup">ã‚¿ã‚¤ã‚¢ãƒƒãƒ—</label>
                </div>
            </div>
            <div id="searchResults"></div>
        </div>
        <div id="list-tab" class="tab-content">
            <div class="list-filter">
                <input type="text" id="listFilter" placeholder="ä¸€è¦§å†…ã‚’æ¤œç´¢ ..."
                    style="padding: 10px; width: 100%; border: 2px solid #e2e8f0; border-radius: 8px;">
                <button class="clear-btn" id="filterClear">Ã—</button>
            </div>
            <div class="table-container">
                <table id="songsTable">
                    <thead>
                        <tr>
                            <th onclick="handleSort('æ›²å')">æ›²å</th>
                            <th onclick="handleSort('ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ')">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ</th>
                            <th onclick="handleSort('æ¼”å¥å›æ•°')">å›æ•°</th>
                            <th onclick="handleSort('æœ€çµ‚æ¼”å¥')">æœ€çµ‚æ¼”å¥</th>
                        </tr>
                    </thead>
                    <tbody id="songListBody"></tbody>
                </table>
            </div>
             <div id="listPagination" class="pagination"></div>
        </div>
    </div>
    <div id="copyToast" class="copy-toast">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</div>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’éåŒæœŸèª­ã¿è¾¼ã¿ -->
    <script src="script.js" async></script>
    
    <!-- LIVEã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—ï¼ˆä½å„ªå…ˆåº¦ï¼‰ -->
    <script>
        // ãƒšãƒ¼ã‚¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã«LIVEã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å–å¾—
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', fetchLiveStatus);
        } else {
            fetchLiveStatus();
        }
        
        function fetchLiveStatus() {
            // requestIdleCallback ã‚’ä½¿ç”¨ã—ã¦ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ãŒç©ºã„ã¦ã„ã‚‹æ™‚ã«å®Ÿè¡Œ
            if ('requestIdleCallback' in window) {
                requestIdleCallback(() => {
                    fetch('https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLg3Mh9pD1cfoLjzGKoWN85Gk3bYFpPA8-oPlNbFXDQwZSrx-7YQn1Qy7_tmEpzzorOTQow9QIbVsKVjgfXUiI3hUpHNtQaVxF5FRYozt4ziG3OutQJSWtSqXCcdeJU7a_Uhr2j0KiH3Kw9PaSSjYaZ-Pxx2MUB2AEtN-ozLj-H6GBxw8JOISVRz8QT-ziXa-lUbnL0NULykgmNlOLH-s4Jnt-Py_bQ05foDbnH9BD7EgMzudhnWfWM6yEP4M21osh0JprLH-ddjFiDhSqven0yIHGmO3cNRqPPRjvzm&lib=MXVx9ipRNFTfomE6WbanXaGJpguNqVXQJ', { signal: AbortSignal.timeout(3000) })
                        .then(response => response.json())
                        .then(data => {
                            const ytLink = document.getElementById('headerYtLink');
                            if (data.liveVideoUrl && data.liveVideoUrl.trim() !== '') {
                                ytLink.href = data.liveVideoUrl;
                                ytLink.title = 'ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚’é–‹ã';
                                const liveBadge = document.getElementById('liveBadge');
                                if (liveBadge) {
                                    liveBadge.classList.add('active');
                                }
                            }
                        })
                        .catch(error => {
                            console.error('ãƒ©ã‚¤ãƒ–é…ä¿¡URLå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                        });
                }, { timeout: 5000 });
            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: é…å»¶å®Ÿè¡Œ
                setTimeout(() => {
                    fetch('https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLg3Mh9pD1cfoLjzGKoWN85Gk3bYFpPA8-oPlNbFXDQwZSrx-7YQn1Qy7_tmEpzzorOTQow9QIbVsKVjgfXUiI3hUpHNtQaVxF5FRYozt4ziG3OutQJSWtSqXCcdeJU7a_Uhr2j0KiH3Kw9PaSSjYaZ-Pxx2MUB2AEtN-ozLj-H6GBxw8JOISVRz8QT-ziXa-lUbnL0NULykgmNlOLH-s4Jnt-Py_bQ05foDbnH9BD7EgMzudhnWfWM6yEP4M21osh0JprLH-ddjFiDhSqven0yIHGmO3cNRqPPRjvzm&lib=MXVx9ipRNFTfomE6WbanXaGJpguNqVXQJ', { signal: AbortSignal.timeout(3000) })
                        .then(response => response.json())
                        .then(data => {
                            const ytLink = document.getElementById('headerYtLink');
                            if (data.liveVideoUrl && data.liveVideoUrl.trim() !== '') {
                                ytLink.href = data.liveVideoUrl;
                                ytLink.title = 'ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚’é–‹ã';
                                const liveBadge = document.getElementById('liveBadge');
                                if (liveBadge) {
                                    liveBadge.classList.add('active');
                                }
                            }
                        })
                        .catch(error => {
                            console.error('ãƒ©ã‚¤ãƒ–é…ä¿¡URLå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                        });
                }, 2000);
            }
        }
    </script>
</body>
</html>
